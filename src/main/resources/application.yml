server:
  port: ${PORT:8080}
  compression:
    enabled: true

spring:
  application:
    name: wallet-service

  datasource:
  #  url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:walletdb}
  #  username: ${DB_USERNAME:walletuser}
  #  password: ${DB_PASSWORD:walletpass}
    url: ${SPRING_DATASOURCE_URL}
    driver-class-name: org.postgresql.Driver

    hikari:
      pool-name: WalletHikariPool
      maximum-pool-size: 5
      minimum-idle: 1
      idle-timeout: 30000
      max-lifetime: 1800000
      connection-timeout: 30000
      leak-detection-threshold: 20000

    jpa:
      hibernate:
        ddl-auto: validate
      open-in-view: false
      properties:
        hibernate:
          dialect: org.hibernate.dialect.PostgreSQLDialect
          format_sql: false
          jdbc:
            time_zone: UTC

  liquibase:
    enabled: true
    change-log: classpath:db/changelog/db-changelog-master.xml

  redis:
    lettuce:
      pool:
        max-active: 8
        max-idle: 8
        min-idle: 2

  data:
    redis:
      url: ${SPRING_REDIS_URL}  #${REDIS_URL} 
      timeout: 2000ms

  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS} #

    properties:
      # ðŸ” AIVEN mTLS
      security.protocol: SSL

      ssl.keystore.location: /tmp/secrets/client.keystore.p12
      ssl.keystore.password: ${KAFKA_SSL_KEYSTORE_PASSWORD}
      ssl.keystore.type: PKCS12

      ssl.truststore.location: /tmp/secrets/client.truststore.jks
      ssl.truststore.password: ${KAFKA_SSL_TRUSTSTORE_PASSWORD}
      ssl.truststore.type: JKS

      # Required for Aiven
      ssl.endpoint.identification.algorithm: ""

    consumer:
      group-id: wallet-service-group
      auto-offset-reset: earliest
      enable-auto-commit: false
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: "com.fintech.wallet.*"
        spring.json.use.type.headers: false

    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
      acks: all

  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 10MB

  web:
    error:
      include-message: always
      include-binding-errors: always

  mail:
    host: smtp.gmail.com
    port: 587
    username: ${EMAIL_USERNAME}
    password: ${EMAIL_PASSWORD}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
            required: true

security:
  jwt:
    secret: ${JWT_SECRET}
    expiration: 3600000
    refresh-expiration: 604800000

payment:
  paystack:
    secret-key: ${PAYSTACK_SECRET_KEY:}
    public-key: ${PAYSTACK_PUBLIC_KEY:}
    base-url: https://api.paystack.co

  flutterwave:
    secret-key: ${FLUTTERWAVE_SECRET_KEY:}
    public-key: ${FLUTTERWAVE_PUBLIC_KEY:}
    base-url: https://api.flutterwave.com/v3

app:
  rate-limit:
    enabled: true
    requests-per-minute: 60

  transaction:
    max-amount: 1000000
    min-amount: 100

  kyc:
    required-for-withdrawal: true
    max-unverified-balance: 50000

  cors:
    allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:4200}

management:
  endpoints:
    web:
      exposure:
        include: "prometheus,health,info"

  endpoint:
    health:
      show-details: always

  metrics:
    tags:
      application: ${spring.application.name}

  prometheus:
    metrics:
      export:
        enabled: true
      enable:
        all: true

logging:
  level:
    com.fintech.wallet: INFO
    org.springframework.security: INFO
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
   # liquibase: DEBUG
  #  org.springframework.boot.autoconfigure.liquibase: DEBUG
 #   org.apache.kafka: DEBUG
  pattern:
    console: >
      {
        "timestamp":"%d{yyyy-MM-dd'T'HH:mm:ss.SSSZ}",
        "level":"%level",
        "service":"${spring.application.name}",
        "traceId":"%X{traceId:-}",
        "spanId":"%X{spanId:-}",
        "thread":"%thread",
        "logger":"%logger{36}",
        "message":"%msg"
      }%n
#  pattern:
#    console: "%d{yyyy-MM-dd HH:mm:ss} - %msg%n"
#    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

#  file:
#    name: logs/wallet-service.log
#    max-size: 10MB
#    max-history: 30

email:
  enabled: ${EMAIL_ENABLED:false}
  from: noreply@yourwallet.com

sms:
  enabled: ${SMS_ENABLED:false}
  provider: TWILIO
  twilio:
    account-sid: ${TWILIO_ACCOUNT_SID}
    auth-token: ${TWILIO_AUTH_TOKEN}
    from-number: ${TWILIO_FROM_NUMBER}

push:
  enabled: ${PUSH_ENABLED:false}
  fcm:
    server-key: ${FCM_SERVER_KEY}

springdoc:
  packages-to-scan: org.fintech.wallet.controller
